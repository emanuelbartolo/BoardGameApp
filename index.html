<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ² Game Night ðŸŽ²</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=2.6">
</head>
<body class="d-flex flex-column vh-100 overflow-hidden">
        <!-- Top strip: loginspiele info and language on the very top (moved inside scroll container) -->
        <header class="site-header flex-shrink-0">
        <div class="top-strip py-1">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="me-1">
                <div class="d-flex align-items-center">
                    <select id="language-switcher" class="form-select form-select-sm me-2">
                    <option value="en">EN</option>
                    <option value="de" selected>DE</option>
                </select>
                    <button id="group-join-btn" class="btn btn-sm btn-outline-primary d-none" type="button" data-i18n-key="group_join_button">Join Group</button>
                    <button id="active-group-display" class="btn btn-sm btn-outline-primary d-none ms-2" type="button" aria-pressed="false" data-bs-toggle="modal" data-bs-target="#group-modal"><span data-i18n-key="group_label">Group:</span> <strong data-i18n-key="default_group_name">Default Group</strong></button>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <div id="user-display" class="d-flex align-items-center"></div>
            </div>
        </div>
    </div>

            <!-- Confirm Leave Modal -->
            <div class="modal fade" id="confirm-leave-modal" tabindex="-1">
                <div class="modal-dialog modal-sm modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" data-i18n-key="group_actions_leave">Leave Group</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="mb-0" data-i18n-key="group_actions_confirm_leave">Are you sure you want to leave this group?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="group_modal_cancel">Cancel</button>
                            <button type="button" id="confirm-leave-yes" class="btn btn-danger">Leave</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full-width banner (edge-to-edge) -->
            <div class="app-banner">
  <div class="container d-flex justify-content-center">
    <a href="#collection" class="d-flex align-items-center text-dark text-decoration-none">
      <span class="app-title fs-4 ms-2" data-i18n-key="title">ðŸŽ² Spieleabend ðŸŽ²</span>
    </a>
  </div>
</div>
    </header>

    <!-- Sticky control row moved here so icons sit under the app title -->
    <div id="collection-controls-fixed">
        <div class="container-fluid">
            <!-- Compact control row: icons only. Tapping an icon expands the related controls below. -->
            <div id="collection-controls-compact" class="d-flex align-items-center gap-2 mb-2">
            <div class="d-flex align-items-center me-2" style="min-width:0;flex:1 1 auto;">
                <button id="search-toggle" class="btn btn-outline-secondary me-1" aria-expanded="false" aria-controls="search-collapse" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16"><path d="M11 6a5 5 0 1 1-10 0 5 5 0 0 1 10 0z"/><path d="M12.9 11.1l3 3-1.4 1.4-3-3A7 7 0 1 1 12.9 11.1z"/></svg>
                </button>
                <button id="sort-toggle" class="btn btn-outline-secondary me-1" aria-expanded="false" aria-controls="sort-collapse" title="Sort">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-sort-down" viewBox="0 0 16 16"><path d="M3.5 2.5a.5.5 0 0 0-1 0v8.793l-1.146-1.147a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L3.5 11.293V2.5zm3.5 1a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM7.5 5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm1.5 2a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5z"/></svg>
                </button>
                <button id="filter-toggle" class="btn btn-outline-secondary me-2" data-bs-toggle="collapse" data-bs-target="#filter-collapse" aria-expanded="false" aria-controls="filter-collapse" title="Filters">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-funnel" viewBox="0 0 16 16"><path d="M1.5 1.5h13l-5.5 6.5V13l-2 1v-5L1.5 1.5z"/></svg>
                </button>
                <span id="collection-count-pill" class="badge bg-secondary collection-count-pill ms-2 d-none" aria-live="polite">0</span>
            </div>
            <!-- Layout icons anchored to the right of the control row -->
            <div class="btn-group ms-auto me-2" role="group" id="layout-switcher" aria-label="Layout options">
                <button type="button" class="btn btn-outline-secondary active" data-layout="large-grid" title="Large Grid">
                    <svg width="28" height="28" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <rect x="1" y="1" width="6" height="6" rx="0.5"></rect>
                        <rect x="9" y="1" width="6" height="6" rx="0.5"></rect>
                        <rect x="1" y="9" width="6" height="6" rx="0.5"></rect>
                        <rect x="9" y="9" width="6" height="6" rx="0.5"></rect>
                    </svg>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-layout="small-grid" title="Small Grid"><svg width="22" height="22" viewBox="0 0 16 16" fill="currentColor" class="bi bi-grid-3x3-gap"><path d="M1 2.5A1.5 1.5 0 0 1 2.5 1H5v4H1V2.5zm5 0A1.5 1.5 0 0 1 7.5 1H10v4H6V2.5zM11 1h2.5A1.5 1.5 0 0 1 15 2.5V5h-4V1zM1 6h4v4H1V6zm5 0h4v4H6V6zM11 6h4v4h-4V6zM1 11h4v2.5A1.5 1.5 0 0 1 3.5 15H1v-4zm5 0h4v4H6v-4zM11 11h4v2.5a1.5 1.5 0 0 1-1.5 1.5H11v-4z"/></svg></button>
                <button type="button" class="btn btn-outline-secondary" data-layout="list" title="List"><svg width="24" height="24" viewBox="0 0 16 16" fill="currentColor" class="bi bi-list"><path fill-rule="evenodd" d="M2.5 12.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/></svg></button>
            </div>
            <div id="user-display" class="d-flex align-items-center"></div>
        </div>

        <!-- Expanded area: search, sort, and filters appear here when toggled -->
        <div id="collection-controls-expanded">
            <div id="search-collapse" class="collapse mb-2">
                <input type="text" id="search-input" class="form-control" data-i18n-key="search_placeholder" placeholder="Search by name...">
            </div>
            <div id="sort-collapse" class="collapse mb-2">
                <div class="input-group">
                    <span class="input-group-text" data-i18n-key="sort_by_label">Sort by:</span>
                    <select id="sort-by-select" class="form-select">
                        <option value="name_asc" data-i18n-key="sort_name_asc">Name (A-Z)</option>
                        <option value="year_asc" data-i18n-key="sort_year_asc">Year (Oldest First)</option>
                        <option value="year_desc" data-i18n-key="sort_year_desc">Year (Newest First)</option>
                        <option value="min_players_asc" data-i18n-key="sort_min_players_asc">Min Players (Low to High)</option>
                        <option value="max_players_asc" data-i18n-key="sort_max_players_asc">Max Players (Low to High)</option>
                    </select>
                </div>
            </div>
            <!-- existing filter-collapse is used here -->
            <div class="collapse" id="filter-collapse">
                <div class="card card-body mb-3">
                    <div class="row g-2 align-items-end">
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_min_players_label">Min Players:</span>
                                <input type="number" id="min-players-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_max_players_label">Max Players:</span>
                                <input type="number" id="max-players-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_max_playtime_label">Max Play Time (min):</span>
                                <input type="number" id="max-playtime-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_year_label">Year Published:</span>
                                <input type="number" id="year-filter" class="form-control" min="1900" max="2100">
                            </div>
                        </div>
                        <div class="col-12 col-lg-9 d-flex flex-wrap gap-2 mt-2">
                            <button id="wishlist-filter-button" class="btn btn-outline-primary btn-sm d-none" data-i18n-key="wishlist_filter_button">My Wishlist</button>
                        </div>
                        <div class="col-12 col-lg-3 mt-2 text-lg-end">
                            <button id="clear-filters-button" class="btn btn-outline-secondary w-100" data-i18n-key="clear_filters_button">Clear Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <div id="main-scroll-container" class="flex-grow-1 overflow-auto position-relative">
        <div class="container py-3">

        <!-- Group Modal (simple list + join-code input) -->
        <div class="modal fade" id="group-modal" tabindex="-1">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" data-i18n-key="group_modal_title">Groups</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-2">
                        <div id="group-list" class="list-group mb-2" role="list">
                            <!-- populated dynamically with simple list items -->
                        </div>

                        <div class="input-group">
                            <input type="text" id="group-join-code" class="form-control" placeholder="Join code (e.g., AB12CD)" data-i18n-key="group_join_code_placeholder">
                            <button id="group-join-submit" class="btn btn-primary" type="button" title="Join" data-i18n-key="group_modal_join_button">Join</button>
                        </div>

                        <div id="group-modal-status" class="text-danger small mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" id="group-join-selected-id" value="">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="group_modal_cancel">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <main>
            <!-- Login View -->
            <section id="login-view">
                <h2 data-i18n-key="login_heading">Login</h2>
                <div class="mb-3">
                    <label for="username-input" class="form-label" data-i18n-key="login_username_label">Enter your username or select existing</label>
                    <input type="text" id="username-input" class="form-control mb-2" placeholder="Enter new username" data-i18n-key="login_username_placeholder">
                    <select id="existing-users-dropdown" class="form-select d-none">
                        <option value="" data-i18n-key="login_select_user_placeholder">--- Select existing user ---</option>
                    </select>
                </div>
                <div class="input-group mb-3 d-none" id="password-field">
                    <input type="password" id="password-input" class="form-control" placeholder="Enter password" data-i18n-key="login_password_placeholder">
                </div>
                <button class="btn btn-primary" type="button" id="login-button" data-i18n-key="login_button">Login</button>
            </section>

            <!-- Collection View -->
            <section id="collection-view" class="d-none">
                <!-- Collection header and list (admin controls moved to Admin view) -->

                <div class="mb-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h2 data-i18n-key="collection_heading" class="mb-0">Game Collection</h2>
                        <p class="text-muted mb-0" data-i18n-key="collection_instruction">Browse the full collection of available games. Click the star to add a game to your personal wishlist.</p>
                    </div>
                    <!-- collection count pill was moved to the controls row for better visibility -->
                </div>

                <div id="game-collection" class="row">
                    <!-- Game cards from Firebase will be inserted here -->
                </div>
            </section>

            <!-- Group Edit View (Admin) -->
            <section id="group-edit-view" class="d-none">
                <div class="card p-3 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 data-i18n-key="group_edit_heading">Edit Group</h3>
                        <button id="group-edit-cancel" class="btn btn-sm btn-outline-secondary" data-i18n-key="group_edit_back">Back to Admin</button>
                    </div>

                    <div class="mb-3">
                        <label for="group-edit-name" class="form-label" data-i18n-key="group_name_label">Group Name</label>
                        <input type="text" id="group-edit-name" class="form-control" placeholder="Friendly name for the group" data-i18n-key="group_name_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="group-edit-code" class="form-label" data-i18n-key="group_join_code_label">Join Code (optional)</label>
                        <input type="text" id="group-edit-code" class="form-control" placeholder="e.g., AB12CD" data-i18n-key="group_join_code_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="group-edit-desc" class="form-label" data-i18n-key="group_description_label">Description (optional)</label>
                        <textarea id="group-edit-desc" class="form-control" rows="3" placeholder="Description shown to members" data-i18n-key="group_description_placeholder"></textarea>
                    </div>

                                    <div class="mb-3">
                                        <h5 class="mb-2" data-i18n-key="group_members_heading">Members</h5>
                                        <div class="input-group mb-2">
                                            <input type="text" id="group-edit-add-username" class="form-control" placeholder="Enter username to add" data-i18n-key="group_add_member_placeholder">
                                            <button id="group-edit-add-btn" class="btn btn-outline-primary" data-i18n-key="group_add_member_button">Add</button>
                                        </div>
                                        <div id="group-edit-members" class="list-group mb-3">
                                            <div class="small text-muted" data-i18n-key="group_loading_members">Loading members...</div>
                                        </div>
                                    </div>

                    <div class="d-flex justify-content-between">
                        <div>
                            <button id="group-edit-save" class="btn btn-primary" data-i18n-key="group_save_button">Save</button>
                            <button id="group-edit-delete" class="btn btn-danger ms-2" data-i18n-key="group_delete_button">Delete</button>
                        </div>
                        <div class="text-muted small align-self-center" data-i18n-key="group_admin_only_note">Only visible to admin</div>
                    </div>
                </div>
            </section>

            <!-- Shortlist View -->
            <section id="shortlist-view" class="d-none">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="mb-0" data-i18n-key="shortlist_heading">Game Shortlist</h2>
                    <div class="d-flex align-items-center">
                        <div id="next-game-label" class="text-muted small me-2 text-end" data-i18n-key="next_game_night_label">Next Game Night:</div>
                        <div id="next-game-night-container"></div>
                    </div>
                </div>
                <p class="text-muted" data-i18n-key="shortlist_instruction">Vote for the games you'd like to play at the next event!</p>
                <div id="shortlist-games" class="row"></div>
            </section>

            <!-- Admin View -->
            <section id="admin-view" class="d-none">
                <div id="admin-panel" class="card bg-light p-3 mb-4">
                    <h4 data-i18n-key="admin_heading">Admin Controls</h4>
                    <p data-i18n-key="admin_description">Update the group's shared game collection from a BGG XML file.</p>
                    <ol>
                        <li>
                            <strong data-i18n-key="admin_get_bgg_file">Get BGG File:</strong> 
                            <a href="https://boardgamegeek.com/xmlapi2/collection?username=leli84&own=1&stats=1" target="_blank" class="btn btn-secondary btn-sm" data-i18n-key="admin_get_bgg_file_button">Get BGG Collection File</a>
                            <small class="d-block text-muted" data-i18n-key="admin_get_bgg_file_help">If you see a "processing" message, wait a minute and refresh that page until the XML appears, then save the file.</small>
                        </li>
                        <li class="mt-2">
                            <strong data-i18n-key="admin_upload_file">Upload File:</strong>
                            <div class="input-group">
                                <input type="file" id="xml-file-input" class="form-control" accept=".xml">
                                <button id="upload-collection-button" class="btn btn-primary" data-i18n-key="admin_upload_button">Upload to Firebase</button>
                            </div>
                        </li>
                    </ol>
                    <div id="upload-status" class="mt-2"></div>
                    <div class="d-flex align-items-center gap-2 mt-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="wishlist-visible-toggle">
                            <label class="form-check-label small" for="wishlist-visible-toggle" data-i18n-key="admin_show_wishlist_toggle">Show wishlist summary</label>
                        </div>
                        <div>
                            <select id="wishlist-group-select" class="form-select form-select-sm">
                                <option value="all" data-i18n-key="wishlist_group_show_all">Show all</option>
                            </select>
                        </div>
                    </div>
                    <div id="wishlist-summary" class="mt-3 d-none"></div>
                </div>

                <!-- API Settings section removed -->

                <!-- User Management (Admin-only) -->
                <div class="card bg-light p-3 mb-4">
                    <h4 data-i18n-key="user_management_heading">User Management</h4>
                    <p data-i18n-key="user_management_description">Manage registered users. Deleting a user will also remove their associated data (favorites, poll votes).</p>
                    <div id="user-list-container" class="list-group"></div>
                </div>

                <!-- Group Management (Admin-only) -->
                <div class="card bg-light p-3 mb-4" id="group-management">
                    <h4 data-i18n-key="group_management_heading">Group Management</h4>
                    <p class="small text-muted" data-i18n-key="group_management_description">Create, edit or delete groups. Only visible to admin.</p>
                    <div class="row g-2 align-items-end mb-3">
                        <div class="col-md-6">
                            <input type="text" id="admin-group-name" class="form-control" placeholder="Group name">
                        </div>
                        <div class="col-md-4">
                            <input type="text" id="admin-group-code" class="form-control" placeholder="Join code (optional)">
                        </div>
                        <div class="col-md-2">
                            <button id="admin-create-group" class="btn btn-primary w-100" data-i18n-key="admin_create_group_button">Create</button>
                        </div>
                    </div>
                    <div id="admin-groups-list" class="list-group"></div>
                </div>
            </section>

            <!-- Polls feature removed -->

            <!-- Events View -->
            <section id="events-view" class="d-none">
                <h2 data-i18n-key="events_heading">Calendar Events</h2>
                <p class="text-muted" data-i18n-key="events_instruction">Vote on the polls to help decide the date for the next event.</p>
                <button id="create-event-button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#create-event-modal" data-i18n-key="events_create_button">Create New Event</button>
                <div id="events-list"></div>

                <h2 class="mt-5" data-i18n-key="polls_heading">Event Date Polls</h2>
                <button id="create-poll-button" class="btn btn-success mb-3 d-none" data-bs-toggle="modal" data-bs-target="#create-poll-modal" data-i18n-key="polls_create_button">Create New Poll</button>
                <div id="polls-list"></div>
            </section>

        </main>
    </div>

    <!-- Create Event Modal -->
    <div class="modal fade" id="create-event-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n-key="modal_create_event_title">Create New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="event-title" class="form-label" data-i18n-key="modal_event_title_label">Event Title</label>
                        <input type="text" class="form-control" id="event-title" placeholder="e.g., Board Game Night" data-i18n-key="modal_event_title_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="event-date" class="form-label" data-i18n-key="modal_date_label">Date</label>
                        <input type="date" class="form-control" id="event-date">
                    </div>
                    <div class="mb-3">
                        <label for="event-time" class="form-label" data-i18n-key="modal_time_label">Time</label>
                        <input type="time" class="form-control" id="event-time">
                    </div>
                    <div class="mb-3">
                        <label for="event-location" class="form-label" data-i18n-key="modal_location_label">Location</label>
                        <input type="text" class="form-control" id="event-location" placeholder="e.g., My place" data-i18n-key="modal_location_placeholder">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Close</button>
                    <button type="button" class="btn btn-primary" id="save-event-button" data-i18n-key="modal_create_event_button">Create Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- (Removed Wishlist Summary modal - using inline summary instead) -->

    <!-- Create Poll Modal -->
    <div class="modal fade" id="create-poll-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n-key="modal_create_poll_title">Create New Poll</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="poll-title" class="form-label" data-i18n-key="modal_poll_title_label">Poll Title</label>
                        <input type="text" class="form-control" id="poll-title" placeholder="e.g., Next Game Night Date" data-i18n-key="modal_poll_title_placeholder">
                    </div>
                    <div id="poll-options-container">
                        <!-- Date options will be added here dynamically -->
                    </div>
                    <button class="btn btn-secondary btn-sm mt-2" id="add-poll-option" data-i18n-key="modal_add_poll_option_button">Add Date Option</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Close</button>
                    <button type="button" class="btn btn-primary" id="save-poll-button" data-i18n-key="modal_create_poll_button">Create Poll</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div class="modal fade" id="game-details-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="game-modal-title" data-i18n-key="modal_game_details_title">Game Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="game-modal-body">
                    <!-- Game details will be loaded here -->
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <div id="modal-favorite-container">
                        <!-- Favorite button will be injected here -->
                    </div>
                    <button id="ai-summary-button" class="btn btn-info" data-i18n-key="modal_ai_summary_button">Generate AI Summary</button>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End of main-scroll-container -->
    </div> <!-- End of container -->

    <!-- Main navigation (moved outside scroll container to be fixed at bottom) -->
    <!-- Set Password Modal -->
    <div class="modal fade" id="set-password-modal" tabindex="-1" aria-labelledby="set-password-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="set-password-modal-label" data-i18n-key="set_password_modal_title">Set Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-2" data-i18n-key="set_password_help">Password is optional. You can set a password to secure your account.</p>
                    <p class="text-muted small mb-3" data-i18n-key="set_password_remove_help"><strong>To remove your password:</strong> Leave both fields empty and click Save.</p>
                    <div class="mb-3">
                        <label for="set-password-input" class="form-label" data-i18n-key="set_password_new_label">New Password</label>
                        <input type="password" id="set-password-input" class="form-control" placeholder="Enter new password (min 4 chars)" data-i18n-key="set_password_new_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="set-password-confirm" class="form-label" data-i18n-key="set_password_confirm_label">Confirm Password</label>
                        <input type="password" id="set-password-confirm" class="form-control" placeholder="Confirm password" data-i18n-key="set_password_confirm_placeholder">
                    </div>
                    <div id="set-password-status" class="text-danger small"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" class="btn btn-primary" id="set-password-save" data-i18n-key="set_password_save_button">Save Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal fade" id="confirm-delete-modal" tabindex="-1" aria-labelledby="confirm-delete-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirm-delete-modal-label" data-i18n-key="confirm_delete_title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirm-delete-text">Are you sure you want to delete this user? This will remove their wishlist and votes.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-yes" data-i18n-key="confirm_delete_yes">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="fixed-bottom-nav">
        <ul class="nav nav-tabs" style="display: flex !important; flex-wrap: nowrap !important; gap: 0.25rem;">
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-login" class="nav-link" href="#login" title="Login" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M14 14s-1-4-6-4-6 4-6 4 1 0 6 0 6 0 6 0z"/></svg></span>
                    <span class="nav-text" data-i18n-key="nav_login">Login</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-collection" class="nav-link" href="#collection" title="Collection" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-grid" viewBox="0 0 16 16"><path d="M1 2.5A1.5 1.5 0 0 1 2.5 1H5v4H1V2.5zM6 1h3v4H6V1zM11 1h2.5A1.5 1.5 0 0 1 15 2.5V5h-4V1zM1 6h4v4H1V6zm5 0h3v4H6V6zM11 6h4v4h-4V6zM1 11h4v2.5A1.5 1.5 0 0 1 3.5 15H1v-4zm5 0h3v4H6v-4zM11 11h4v2.5a1.5 1.5 0 0 1-1.5 1.5H11v-4z"/></svg></span>
                    <span class="nav-text" data-i18n-key="nav_collection">Collection</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-shortlist" class="nav-link" href="#shortlist" title="Shortlist" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 12.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/></svg></span>
                    <span class="nav-text" data-i18n-key="nav_shortlist">Shortlist</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-events" class="nav-link" href="#events" title="Events" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16"><path d="M14 3h-1V2a.5.5 0 0 0-1 0v1H4V2a.5.5 0 0 0-1 0v1H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zM1 6v7a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6H1z"/></svg></span>
                    <span class="nav-text" data-i18n-key="events">Events</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-admin" class="nav-link" href="#admin" title="Admin" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16"><path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/><path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.89-3.433.902-2.543 2.543l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.89 1.64.902 3.433 2.543 2.543l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.159c1.64.89 3.433-.902 2.543-2.543l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.159-.292c.89-1.64-.902-3.433-2.543-2.543l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/></svg></span>
                    <span class="nav-text" data-i18n-key="nav_admin">Admin</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- User Options Modal -->
    <div class="modal fade" id="user-options-modal" tabindex="-1" aria-labelledby="user-options-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-options-modal-label" data-i18n-key="user_options_title">User Options</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-grid gap-2">
                        <button id="user-opt-set-password" class="btn btn-outline-primary" data-i18n-key="user_opt_set_password">Set/Reset Password</button>
                        <button id="user-opt-change-username" class="btn btn-outline-secondary" data-i18n-key="user_opt_change_username">Change Username</button>
                        <button id="user-opt-logout" class="btn btn-outline-danger" data-i18n-key="user_opt_logout">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Username Modal -->
    <div class="modal fade" id="change-username-modal" tabindex="-1" aria-labelledby="change-username-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="change-username-modal-label" data-i18n-key="change_username_title">Change Username</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted" data-i18n-key="change_username_help">Changing username will migrate your wishlist and update votes. Existing username will be removed.</p>
                    <div class="mb-2">
                        <label for="change-username-input" class="form-label" data-i18n-key="change_username_new_label">New username</label>
                        <input id="change-username-input" class="form-control" placeholder="Enter new username" data-i18n-key="change_username_placeholder">
                    </div>
                    <div id="change-username-status" class="small text-danger"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" id="change-username-save" class="btn btn-primary" data-i18n-key="change_username_save">Change</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Use Firebase v8 for simplicity and compatibility -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <script src="js/firebase-config.js?v=2.5"></script>
    <script src="js/ics.js?v=2.4"></script>
    <script src="js/bgg.js?v=2.4"></script>
    <script src="js/app.js?v=2.4" defer></script>
</body>
</html>
