<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ² Game Night ðŸŽ²</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=2.6">
</head>
<body class="d-flex flex-column vh-100 overflow-hidden">
        <!-- Top strip: loginspiele info and language on the very top (moved inside scroll container) -->
        <header class="site-header flex-shrink-0">
        <div class="top-strip py-1">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="me-1">
                <div class="d-flex align-items-center">
                    <select id="language-switcher" class="form-select form-select-sm me-2">
                    <option value="en">EN</option>
                    <option value="de" selected>DE</option>
                </select>
                    <button id="group-join-btn" class="btn btn-sm btn-outline-primary d-none" type="button" data-i18n-key="group_join_button">Join Group</button>
                    <button id="active-group-display" class="btn btn-sm btn-outline-primary d-none ms-2" type="button" aria-pressed="false" data-bs-toggle="modal" data-bs-target="#group-modal"><strong data-i18n-key="default_group_name">Default Group</strong></button>
                </div>
            </div>
            <div class="d-flex align-items-center">
                <div id="user-display" class="d-flex align-items-center"></div>
            </div>
        </div>
    </div>

            <!-- Confirm Leave Modal -->
            <div class="modal fade" id="confirm-leave-modal" tabindex="-1">
                <div class="modal-dialog modal-sm modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" data-i18n-key="group_actions_leave">Leave Group</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p class="mb-0" data-i18n-key="group_actions_confirm_leave">Are you sure you want to leave this group?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="group_modal_cancel">Cancel</button>
                            <button type="button" id="confirm-leave-yes" class="btn btn-danger">Leave</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Full-width banner (edge-to-edge) -->
            <div class="app-banner">
  <div class="container d-flex justify-content-center">
    <a href="#collection" class="d-flex align-items-center text-dark text-decoration-none">
      <span class="app-title fs-4 ms-2" data-i18n-key="title">ðŸŽ² Spieleabend ðŸŽ²</span>
    </a>
  </div>
</div>
    </header>

    <!-- Sticky control row moved here so icons sit under the app title -->
    <div id="collection-controls-fixed">
        <div class="container-fluid">
            <!-- Compact control row: icons only. Tapping an icon expands the related controls below. -->
            <div id="collection-controls-compact" class="d-flex align-items-center gap-2 mb-2">
            <div class="d-flex align-items-center me-2" style="min-width:0;flex:1 1 auto;">
                <button id="search-toggle" class="btn btn-outline-secondary me-1" aria-expanded="false" aria-controls="search-collapse" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M333.78 20.188c-39.97 0-79.96 15.212-110.405 45.656-58.667 58.667-60.796 152.72-6.406 213.97l-15.782 15.748 13.25 13.25 15.75-15.78c61.248 54.39 155.3 52.26 213.968-6.407 60.887-60.886 60.888-159.894 0-220.78C413.713 35.4 373.753 20.187 333.78 20.187zm0 18.562c35.15 0 70.285 13.44 97.158 40.313 53.745 53.745 53.744 140.6 0 194.343-51.526 51.526-133.46 53.643-187.5 6.375l.218-.217c-2.35-2.05-4.668-4.17-6.906-6.407-2.207-2.206-4.288-4.496-6.313-6.812l-.218.22c-47.27-54.04-45.152-135.976 6.374-187.502C263.467 52.19 298.63 38.75 333.78 38.75zm0 18.813c-30.31 0-60.63 11.6-83.81 34.78-46.362 46.362-46.362 121.234 0 167.594 10.14 10.142 21.632 18.077 33.905 23.782-24.91-19.087-40.97-49.133-40.97-82.94 0-15.323 3.292-29.888 9.22-43-4.165 20.485.44 40.88 14.47 54.907 24.583 24.585 68.744 20.318 98.624-9.562 29.88-29.88 34.146-74.04 9.56-98.625a52.379 52.379 0 0 0-7.655-6.313c45.13 8.648 79.954 46.345 84.25 92.876 4.44-35.07-6.82-71.726-33.813-98.72-23.18-23.18-53.47-34.78-83.78-34.78zM176.907 297.688 42.094 432.5l34.562 34.563L211.47 332.25l-34.564-34.563zM40 456.813 24 472.78 37.22 486l15.968-16L40 456.812z" fill="currentColor"></path></g></svg>
                </button>
                <button id="sort-toggle" class="btn btn-outline-secondary me-1" aria-expanded="false" aria-controls="sort-collapse" title="Sort">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M428.4 27.8v456.4h60.9V27.8h-60.9zM327 168.2v316h60.8v-316H327zM225.4 273.6v210.6h61V273.6h-61zM124 343.8v140.4h60.9V343.8H124zM22.67 394.9v89.3h60.84v-89.3H22.67z" fill="currentColor" transform="translate(512, 0) scale(-1, 1) rotate(-90, 256, 256) skewX(0) skewY(0)"></path></g></svg>
                </button>
                <button id="filter-toggle" class="btn btn-outline-secondary me-2" data-bs-toggle="collapse" data-bs-target="#filter-collapse" aria-expanded="false" aria-controls="filter-collapse" title="Filters">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M256 23c-62.377 0-118.824 5.375-160.277 14.258-20.727 4.441-37.674 9.69-50.188 16.03-26.54 16.094-31.144 53.2-21.918 77.99C69.915 217.435 138.57 281.384 215 340.321V489c25.848-.604 80.089-14.04 82-41V340.322c67.639-60.819 155.483-122.156 191.383-209.045 5.479-17.026 3.503-55.854-6.424-67.166-4.04-4.23-9.237-7.654-15.494-10.824-12.514-6.34-29.461-11.588-50.188-16.03C374.824 28.376 318.377 23 256 23zm0 18c61.335 0 116.887 5.37 156.506 13.86C422.354 57.71 470.826 69.626 471 80c.175 10.464-46.091 22.442-58.494 25.14C372.886 113.63 317.335 119 256 119c-61.335 0-116.887-5.37-156.506-13.86C89.646 102.29 40.887 89.064 41 80c.12-9.68 46.092-22.442 58.494-25.14C139.114 46.37 194.665 41 256 41z" fill="currentColor"></path></g></svg>
                </button>
                <span id="collection-count-pill" class="badge bg-secondary collection-count-pill ms-2 d-none" aria-live="polite">0</span>
            </div>
            <!-- Layout icons anchored to the right of the control row -->
            <div class="btn-group ms-auto me-2" role="group" id="layout-switcher" aria-label="Layout options">
                <button type="button" class="btn btn-outline-secondary active" data-layout="large-grid" title="Large Grid">
                    <svg width="24" height="24" viewBox="0 0 145.19781 145.19781" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-33.876125,-164.80627)"><g transform="translate(-0.52047265,95.246495)"><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="34.396599" y="69.559769" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="112.28202" y="69.559769" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="112.28202" y="147.44521" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="34.396599" y="147.44521" rx="15.36969" /></g></g></svg>
                </button>
                <button type="button" class="btn btn-outline-secondary" data-layout="small-grid" title="Small Grid"><svg width="24" height="24" viewBox="0 0 145.14493 145.14494" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-33.85874,-9.7141063)"><g transform="translate(0,-66.100026)"><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="33.858738" y="75.814133" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="84.53344" y="75.814133" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="135.20815" y="75.814133" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="84.53344" y="126.48883" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="33.858738" y="126.48883" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="135.20815" y="126.48883" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="135.20815" y="177.16354" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="84.53344" y="177.16354" rx="10" /><rect style="fill:currentColor;stroke-width:0.264583" width="43.795536" height="43.795536" x="33.858738" y="177.16354" rx="10" /></g></g></svg></button>
                <button type="button" class="btn btn-outline-secondary" data-layout="list" title="List"><svg width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z" fill="currentColor" transform="translate(512, 0) scale(-1, 1) rotate(-180, 256, 256) skewX(0) skewY(0)"></path></g></svg></button>
            </div>
                    <div id="user-display" class="d-flex align-items-center"></div>
        </div>

        <!-- Expanded area: search, sort, and filters appear here when toggled -->
        <div id="collection-controls-expanded">
            <div id="search-collapse" class="collapse mb-2">
                <input type="text" id="search-input" class="form-control" data-i18n-key="search_placeholder" placeholder="Search by name...">
            </div>
            <div id="sort-collapse" class="collapse mb-2">
                <div class="input-group">
                    <span class="input-group-text" data-i18n-key="sort_by_label">Sort by:</span>
                    <select id="sort-by-select" class="form-select">
                        <option value="name_asc" data-i18n-key="sort_name_asc">Name (A-Z)</option>
                        <option value="year_asc" data-i18n-key="sort_year_asc">Year (Oldest First)</option>
                        <option value="year_desc" data-i18n-key="sort_year_desc">Year (Newest First)</option>
                        <option value="min_players_asc" data-i18n-key="sort_min_players_asc">Min Players (Low to High)</option>
                        <option value="max_players_asc" data-i18n-key="sort_max_players_asc">Max Players (Low to High)</option>
                    </select>
                </div>
            </div>
            <!-- existing filter-collapse is used here -->
            <div class="collapse" id="filter-collapse">
                <div class="card card-body mb-3">
                    <div class="row g-2 align-items-end">
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_min_players_label">Min Players:</span>
                                <input type="number" id="min-players-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_max_players_label">Max Players:</span>
                                <input type="number" id="max-players-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_max_playtime_label">Max Play Time (min):</span>
                                <input type="number" id="max-playtime-filter" class="form-control" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                            <div class="input-group">
                                <span class="input-group-text" data-i18n-key="filter_year_label">Year Published:</span>
                                <input type="number" id="year-filter" class="form-control" min="1900" max="2100">
                            </div>
                        </div>
                        <div class="col-12 col-lg-9 d-flex flex-wrap gap-2 mt-2">
                            <button id="wishlist-filter-button" class="btn btn-outline-primary btn-sm d-none" data-i18n-key="wishlist_filter_button">My Wishlist</button>
                        </div>
                        <div class="col-12 col-lg-3 mt-2 text-lg-end">
                            <button id="clear-filters-button" class="btn btn-outline-secondary w-100" data-i18n-key="clear_filters_button">Clear Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <div id="main-scroll-container" class="flex-grow-1 overflow-auto position-relative">
        <div class="container py-3">

        <!-- Group Modal (simple list + join-code input) -->
        <div class="modal fade" id="group-modal" tabindex="-1">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" data-i18n-key="group_modal_title">Groups</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-2">
                        <div id="group-list" class="list-group mb-2" role="list">
                            <!-- populated dynamically with simple list items -->
                        </div>

                        <div class="input-group">
                            <input type="text" id="group-join-code" class="form-control" placeholder="Join code (e.g., AB12CD)" data-i18n-key="group_join_code_placeholder">
                            <button id="group-join-submit" class="btn btn-primary" type="button" title="Join" data-i18n-key="group_modal_join_button">Join</button>
                        </div>

                        <div id="group-modal-status" class="text-danger small mt-2"></div>
                    </div>
                    <div class="modal-footer">
                        <input type="hidden" id="group-join-selected-id" value="">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="group_modal_cancel">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <main>
            <!-- Login View -->
            <section id="login-view">
                <h2 data-i18n-key="login_heading">Login</h2>
                <div class="mb-3">
                    <label for="username-input" class="form-label" data-i18n-key="login_username_label">Enter your username or select existing</label>
                    <input type="text" id="username-input" class="form-control mb-2" placeholder="Enter new username" data-i18n-key="login_username_placeholder">
                    <select id="existing-users-dropdown" class="form-select d-none">
                        <option value="" data-i18n-key="login_select_user_placeholder">--- Select existing user ---</option>
                    </select>
                </div>
                <div class="input-group mb-3 d-none" id="password-field">
                    <input type="password" id="password-input" class="form-control" placeholder="Enter password" data-i18n-key="login_password_placeholder">
                </div>
                <button class="btn btn-primary" type="button" id="login-button" data-i18n-key="login_button">Login</button>
            </section>

            <!-- Collection View -->
            <section id="collection-view" class="d-none">
                <!-- Collection header and list (admin controls moved to Admin view) -->

                <div class="mb-2 d-flex align-items-center justify-content-between">
                    <div>
                        <h2 data-i18n-key="collection_heading" class="mb-0">Game Collection</h2>
                        <p class="text-muted mb-0" data-i18n-key="collection_instruction">Browse the full collection of available games. Click the star to add a game to your personal wishlist.</p>
                    </div>
                    <!-- collection count pill was moved to the controls row for better visibility -->
                </div>

                <div id="game-collection" class="row">
                    <!-- Game cards from Firebase will be inserted here -->
                </div>
            </section>

            <!-- Group Edit View (Admin) -->
            <section id="group-edit-view" class="d-none">
                <div class="card p-3 mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3 data-i18n-key="group_edit_heading">Edit Group</h3>
                        <button id="group-edit-cancel" class="btn btn-sm btn-outline-secondary" data-i18n-key="group_edit_back">Back to Admin</button>
                    </div>

                    <div class="mb-3">
                        <label for="group-edit-name" class="form-label" data-i18n-key="group_name_label">Group Name</label>
                        <input type="text" id="group-edit-name" class="form-control" placeholder="Friendly name for the group" data-i18n-key="group_name_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="group-edit-code" class="form-label" data-i18n-key="group_join_code_label">Join Code (optional)</label>
                        <input type="text" id="group-edit-code" class="form-control" placeholder="e.g., AB12CD" data-i18n-key="group_join_code_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="group-edit-desc" class="form-label" data-i18n-key="group_description_label">Description (optional)</label>
                        <textarea id="group-edit-desc" class="form-control" rows="3" placeholder="Description shown to members" data-i18n-key="group_description_placeholder"></textarea>
                    </div>

                                    <div class="mb-3">
                                        <h5 class="mb-2" data-i18n-key="group_members_heading">Members</h5>
                                        <div class="input-group mb-2">
                                            <input type="text" id="group-edit-add-username" class="form-control" placeholder="Enter username to add" data-i18n-key="group_add_member_placeholder">
                                            <button id="group-edit-add-btn" class="btn btn-outline-primary" data-i18n-key="group_add_member_button">Add</button>
                                        </div>
                                        <div id="group-edit-members" class="list-group mb-3">
                                            <div class="small text-muted" data-i18n-key="group_loading_members">Loading members...</div>
                                        </div>
                                    </div>

                    <div class="d-flex justify-content-between">
                        <div>
                            <button id="group-edit-save" class="btn btn-primary" data-i18n-key="group_save_button">Save</button>
                            <button id="group-edit-delete" class="btn btn-danger ms-2" data-i18n-key="group_delete_button">Delete</button>
                        </div>
                        <div class="text-muted small align-self-center" data-i18n-key="group_admin_only_note">Only visible to admin</div>
                    </div>
                </div>
            </section>

            <!-- Shortlist View -->
            <section id="shortlist-view" class="d-none">
                <div class="d-flex align-items-center justify-content-between mb-2">
                    <h2 class="mb-0" data-i18n-key="shortlist_heading">Game Shortlist</h2>
                    <div class="d-flex align-items-center">
                        <div id="next-game-label" class="text-muted small me-2 text-end" data-i18n-key="next_game_night_label">Next Game Night:</div>
                        <div id="next-game-night-container"></div>
                    </div>
                </div>
                <p class="text-muted" data-i18n-key="shortlist_instruction">Vote for the games you'd like to play at the next event!</p>
                <div id="shortlist-games" class="row"></div>
            </section>

            <!-- Admin View -->
            <section id="admin-view" class="d-none">
                <div id="admin-panel" class="card bg-light p-3 mb-4">
                    <h4 data-i18n-key="admin_heading">Admin Controls</h4>
                    <p data-i18n-key="admin_description">Update the group's shared game collection from a BGG XML file.</p>
                    <ol>
                        <li>
                            <strong data-i18n-key="admin_get_bgg_file">Get BGG File:</strong> 
                            <a href="https://boardgamegeek.com/xmlapi2/collection?username=leli84&own=1&stats=1" target="_blank" class="btn btn-secondary btn-sm" data-i18n-key="admin_get_bgg_file_button">Get BGG Collection File</a>
                            <small class="d-block text-muted" data-i18n-key="admin_get_bgg_file_help">If you see a "processing" message, wait a minute and refresh that page until the XML appears, then save the file.</small>
                        </li>
                        <li class="mt-2">
                            <strong data-i18n-key="admin_upload_file">Upload File:</strong>
                            <div class="input-group">
                                <input type="file" id="xml-file-input" class="form-control" accept=".xml">
                                <button id="upload-collection-button" class="btn btn-primary" data-i18n-key="admin_upload_button">Upload to Firebase</button>
                            </div>
                        </li>
                    </ol>
                    <div id="upload-status" class="mt-2"></div>
                    <div class="d-flex align-items-center gap-2 mt-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="wishlist-visible-toggle">
                            <label class="form-check-label small" for="wishlist-visible-toggle" data-i18n-key="admin_show_wishlist_toggle">Show wishlist summary</label>
                        </div>
                        <div>
                            <select id="wishlist-group-select" class="form-select form-select-sm">
                                <option value="all" data-i18n-key="wishlist_group_show_all">Show all</option>
                            </select>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-2 mt-2">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="login-dropdown-toggle">
                            <label class="form-check-label small" for="login-dropdown-toggle" data-i18n-key="admin_show_login_dropdown_toggle">Show user dropdown on login</label>
                        </div>
                    </div>
                    <div id="wishlist-summary" class="mt-3 d-none"></div>
                </div>

                <!-- API Settings section removed -->

                <!-- User Management (Admin-only) -->
                <div class="card bg-light p-3 mb-4">
                    <h4 data-i18n-key="user_management_heading">User Management</h4>
                    <p data-i18n-key="user_management_description">Manage registered users. Deleting a user will also remove their associated data (favorites, poll votes).</p>
                    <div id="user-list-container" class="list-group"></div>
                </div>

                <!-- Group Management (Admin-only) -->
                <div class="card bg-light p-3 mb-4" id="group-management">
                    <h4 data-i18n-key="group_management_heading">Group Management</h4>
                    <p class="small text-muted" data-i18n-key="group_management_description">Create, edit or delete groups. Only visible to admin.</p>
                    <div class="row g-2 align-items-end mb-3">
                        <div class="col-md-6">
                            <input type="text" id="admin-group-name" class="form-control" placeholder="Group name">
                        </div>
                        <div class="col-md-4">
                            <input type="text" id="admin-group-code" class="form-control" placeholder="Join code (optional)">
                        </div>
                        <div class="col-md-2">
                            <button id="admin-create-group" class="btn btn-primary w-100" data-i18n-key="admin_create_group_button">Create</button>
                        </div>
                    </div>
                    <div id="admin-groups-list" class="list-group"></div>
                </div>
            </section>

            <!-- Polls feature removed -->

            <!-- Events View -->
            <section id="events-view" class="d-none">
                <h2 data-i18n-key="events_heading">Calendar Events</h2>
                <p class="text-muted" data-i18n-key="events_instruction">Vote on the polls to help decide the date for the next event.</p>
                <button id="create-event-button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#create-event-modal" data-i18n-key="events_create_button">Create New Event</button>
                <div id="events-list"></div>

                <h2 class="mt-5" data-i18n-key="polls_heading">Event Date Polls</h2>
                <button id="create-poll-button" class="btn btn-success mb-3 d-none" data-bs-toggle="modal" data-bs-target="#create-poll-modal" data-i18n-key="polls_create_button">Create New Poll</button>
                <div id="polls-list"></div>
            </section>

        </main>
    </div>

    <!-- Create Event Modal -->
    <div class="modal fade" id="create-event-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n-key="modal_create_event_title">Create New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="event-title" class="form-label" data-i18n-key="modal_event_title_label">Event Title</label>
                        <input type="text" class="form-control" id="event-title" placeholder="e.g., Board Game Night" data-i18n-key="modal_event_title_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="event-date" class="form-label" data-i18n-key="modal_date_label">Date</label>
                        <input type="date" class="form-control" id="event-date">
                    </div>
                    <div class="mb-3">
                        <label for="event-time" class="form-label" data-i18n-key="modal_time_label">Time</label>
                        <input type="time" class="form-control" id="event-time">
                    </div>
                    <div class="mb-3">
                        <label for="event-location" class="form-label" data-i18n-key="modal_location_label">Location</label>
                        <input type="text" class="form-control" id="event-location" placeholder="e.g., My place" data-i18n-key="modal_location_placeholder">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Close</button>
                    <button type="button" class="btn btn-primary" id="save-event-button" data-i18n-key="modal_create_event_button">Create Event</button>
                </div>
            </div>
        </div>
    </div>

    <!-- (Removed Wishlist Summary modal - using inline summary instead) -->

    <!-- Create Poll Modal -->
    <div class="modal fade" id="create-poll-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n-key="modal_create_poll_title">Create New Poll</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="poll-title" class="form-label" data-i18n-key="modal_poll_title_label">Poll Title</label>
                        <input type="text" class="form-control" id="poll-title" placeholder="e.g., Next Game Night Date" data-i18n-key="modal_poll_title_placeholder">
                    </div>
                    <div id="poll-options-container">
                        <!-- Date options will be added here dynamically -->
                    </div>
                    <button class="btn btn-secondary btn-sm mt-2" id="add-poll-option" data-i18n-key="modal_add_poll_option_button">Add Date Option</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Close</button>
                    <button type="button" class="btn btn-primary" id="save-poll-button" data-i18n-key="modal_create_poll_button">Create Poll</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Details Modal -->
    <div class="modal fade" id="game-details-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="game-modal-title" data-i18n-key="modal_game_details_title">Game Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="game-modal-body">
                    <!-- Game details will be loaded here -->
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <div id="modal-favorite-container">
                        <!-- Favorite button will be injected here -->
                    </div>
                    <button id="ai-summary-button" class="btn btn-info" data-i18n-key="modal_ai_summary_button">Generate AI Summary</button>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End of main-scroll-container -->
    </div> <!-- End of container -->

    <!-- Main navigation (moved outside scroll container to be fixed at bottom) -->
    <!-- Set Password Modal -->
    <div class="modal fade" id="set-password-modal" tabindex="-1" aria-labelledby="set-password-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="set-password-modal-label" data-i18n-key="set_password_modal_title">Set Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small mb-2" data-i18n-key="set_password_help">Password is optional. You can set a password to secure your account.</p>
                    <p class="text-muted small mb-3" data-i18n-key="set_password_remove_help"><strong>To remove your password:</strong> Leave both fields empty and click Save.</p>
                    <div class="mb-3">
                        <label for="set-password-input" class="form-label" data-i18n-key="set_password_new_label">New Password</label>
                        <input type="password" id="set-password-input" class="form-control" placeholder="Enter new password (min 4 chars)" data-i18n-key="set_password_new_placeholder">
                    </div>
                    <div class="mb-3">
                        <label for="set-password-confirm" class="form-label" data-i18n-key="set_password_confirm_label">Confirm Password</label>
                        <input type="password" id="set-password-confirm" class="form-control" placeholder="Confirm password" data-i18n-key="set_password_confirm_placeholder">
                    </div>
                    <div id="set-password-status" class="text-danger small"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" class="btn btn-primary" id="set-password-save" data-i18n-key="set_password_save_button">Save Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal fade" id="confirm-delete-modal" tabindex="-1" aria-labelledby="confirm-delete-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirm-delete-modal-label" data-i18n-key="confirm_delete_title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirm-delete-text">Are you sure you want to delete this user? This will remove their wishlist and votes.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete-yes" data-i18n-key="confirm_delete_yes">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <nav class="fixed-bottom-nav">
        <ul class="nav nav-tabs" style="display: flex !important; flex-wrap: nowrap !important; gap: 0.25rem;">
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-login" class="nav-link" href="#login" title="Login" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16"><path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/><path fill-rule="evenodd" d="M14 14s-1-4-6-4-6 4-6 4 1 0 6 0 6 0 6 0z"/></svg></span>
                    <span class="nav-text" data-i18n-key="nav_login">Login</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-collection" class="nav-link" href="#collection" title="Collection" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg width="24" height="24" viewBox="0 0 145.19781 145.19781" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><g transform="translate(-33.876125,-164.80627)"><g transform="translate(-0.52047265,95.246495)"><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="34.396599" y="69.559769" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="112.28202" y="69.559769" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="112.28202" y="147.44521" rx="15.36969" /><rect style="fill:currentColor;stroke-width:0.406656" width="67.312386" height="67.312386" x="34.396599" y="147.44521" rx="15.36969" /></g></g></svg></span>
                    <span class="nav-text" data-i18n-key="nav_collection">Collection</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-shortlist" class="nav-link" href="#shortlist" title="Shortlist" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z" fill="currentColor" transform="translate(512, 0) scale(-1, 1) rotate(-180, 256, 256) skewX(0) skewY(0)"></path></g></svg></span>
                    <span class="nav-text" data-i18n-key="nav_shortlist">Shortlist</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-events" class="nav-link" href="#events" title="Events" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M119 31v66h18V31h-18zm256 0v66h18V31h-18zM73 89v30h366V89h-28v26h-54V89H155v26h-54V89H73zm0 48v302h366V137H73zm110 14h18v32h46v-32h18v32h46v-32h18v32h46v-32h18v32h32v18h-32v46h32v18h-32v46h32v18h-32v46h32v18H265v32h-18v-32h-46v32h-18v-32h-46v32h-18v-32H87v-18h32v-46H87v-18h32v-46H87v-18h32v-46H87v-18h96v-32zm-46 50v46h46v-46h-46zm64 0v46h46v-46h-46zm64 0v46h46v-46h-46zm64 0v46h46v-46h-46zm-192 64v46h46v-46h-46zm64 0v46h46v-46h-46zm64 0v13.27A25.379 25.379 0 0 1 278.27 265H265zm32.73 0A25.379 25.379 0 0 1 311 278.27V265h-13.27zm31.27 0v46h46v-46h-46zm-41 16c-3.973 0-7 3.027-7 7s3.027 7 7 7 7-3.027 7-7-3.027-7-7-7zm-23 16.73V311h13.27A25.379 25.379 0 0 1 265 297.73zm46 0A25.379 25.379 0 0 1 297.73 311H311v-13.27zM137 329v46h46v-46h-46zm64 0v46h46v-46h-46zm64 0v46h46v-46h-46zm64 0v46h46v-46h-46z" fill="currentColor" transform="translate(512, 0) scale(-1, 1) rotate(-360, 256, 256) skewX(0) skewY(0)"></path></g></svg></span>
                    <span class="nav-text" data-i18n-key="nav_events">Events</span>
                </a>
            </li>
            <li class="nav-item" style="flex: 1 1 auto; min-width: 0;">
                <a id="nav-admin" class="nav-link" href="#admin" title="Admin" style="width: 100%; padding: 0.4rem clamp(0.1rem, 1vw, 0.4rem) !important; font-size: clamp(0.65rem, 1.5vw, 0.8rem) !important; text-align: center; white-space: normal; overflow: visible; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <span class="nav-icon" aria-hidden="true" style="font-size: 1.4rem; line-height: 1; margin-bottom: 0.25rem;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512"><g transform="translate(0,0)"><path d="M234.875 18.78c-26.087 2.367-51.557 8.56-74.875 18.782 15.37 32.763 14.222 66.706-6.72 82.407-20.835 15.617-54.055 7.965-81.124-15.69-16.246 19.452-29.336 41.36-38.875 65.626 33.83 12.333 56.635 37.665 52.94 63.5-3.698 25.835-32.697 43.74-68.626 46.094 2.338 25.796 8.91 50.778 18.937 73.875 17.81-8.182 35.793-11.09 51.095-8.938 13.032 1.87 23.927 7.015 31.156 16.657 15.817 21.097 7.603 54.713-16.78 81.97 19.516 16.35 42.216 29.444 66.594 39.03 12.33-33.828 37.655-56.634 63.5-52.938 25.844 3.697 43.74 32.696 46.094 68.625 26.087-2.365 51.557-8.555 74.875-18.78-15.766-32.997-14.26-67.588 6.843-83.406 9.64-7.23 22.568-9.022 35.594-7.125 15.112 2.16 31.19 10.25 45.563 22.78 16.088-19.345 29.4-41.51 38.875-65.594-33.83-12.332-56.635-37.653-52.938-63.5 3.697-25.846 32.665-43.772 68.594-46.125-2.36-25.944-8.774-50.663-18.906-73.874-32.612 15.117-66.66 13.145-82.282-7.687-15.696-20.944-7.252-53.86 16.688-81-19.52-16.352-42.248-29.447-66.625-39.032-12.332 33.828-37.657 56.66-63.5 52.968-25.846-3.693-43.744-32.696-46.095-68.625zm21.656 95.126c79.626 0 144.376 64.752 144.376 144.375 0 79.626-64.75 144.376-144.375 144.376-79.624 0-144.374-64.75-144.374-144.375 0-79.624 64.75-144.374 144.375-144.374zm0 18.688c-69.524 0-125.686 56.162-125.686 125.687 0 69.526 56.162 125.69 125.687 125.69 69.526 0 125.69-56.164 125.69-125.69 0-69.522-56.164-125.686-125.69-125.686zm.033 15.125c61.094 0 110.625 49.53 110.625 110.624 0 61.095-49.53 110.625-110.625 110.625s-110.625-49.53-110.625-110.626c0-61.095 49.53-110.625 110.625-110.625z" fill="currentColor" transform="translate(512, 0) scale(-1, 1) rotate(-180, 256, 256) skewX(0) skewY(0)"></path></g></svg></span>
                    <span class="nav-text" data-i18n-key="nav_admin">Admin</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- User Options Modal -->
    <div class="modal fade" id="user-options-modal" tabindex="-1" aria-labelledby="user-options-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="user-options-modal-label" data-i18n-key="user_options_title">User Options</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-grid gap-2">
                        <button id="user-opt-set-password" class="btn btn-outline-primary" data-i18n-key="user_opt_set_password">Set/Reset Password</button>
                        <button id="user-opt-change-username" class="btn btn-outline-secondary" data-i18n-key="user_opt_change_username">Change Username</button>
                        <button id="user-opt-logout" class="btn btn-outline-danger" data-i18n-key="user_opt_logout">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Username Modal -->
    <div class="modal fade" id="change-username-modal" tabindex="-1" aria-labelledby="change-username-modal-label" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="change-username-modal-label" data-i18n-key="change_username_title">Change Username</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted" data-i18n-key="change_username_help">Changing username will migrate your wishlist and update votes. Existing username will be removed.</p>
                    <div class="mb-2">
                        <label for="change-username-input" class="form-label" data-i18n-key="change_username_new_label">New username</label>
                        <input id="change-username-input" class="form-control" placeholder="Enter new username" data-i18n-key="change_username_placeholder">
                    </div>
                    <div id="change-username-status" class="small text-danger"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="modal_close_button">Cancel</button>
                    <button type="button" id="change-username-save" class="btn btn-primary" data-i18n-key="change_username_save">Change</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Use Firebase v8 for simplicity and compatibility -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-functions.js"></script>
    <script src="js/firebase-config.js?v=2.5"></script>
    <script src="js/ics.js?v=2.4"></script>
    <script src="js/bgg.js?v=2.4"></script>
    <script src="js/app.js?v=2.4" defer></script>
</body>
</html>
